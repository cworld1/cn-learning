import{_ as n,o as a,c as s,e}from"./app-31661a2b.js";const t="/assets/image-20230404211701800-741fffa8.png",i="/assets/image-20230404212038243-5654dc9d.png",l="/assets/image-20230406111834389-0f436a92.png",p="/assets/image-20230406111251960-09e3e29a.png",r="/assets/image-20230406112024277-db312d24.png",d="/assets/image-20230406112048633-7d019a25.png",c="/assets/image-20230406113249538-0d802446.png",o="/assets/image-20230406113344329-0895e576.png",u={},m=e('<h1 id="_6-访问控制列表及防火墙使用" tabindex="-1"><a class="header-anchor" href="#_6-访问控制列表及防火墙使用" aria-hidden="true">#</a> 6. 访问控制列表及防火墙使用</h1><h2 id="实验目的" tabindex="-1"><a class="header-anchor" href="#实验目的" aria-hidden="true">#</a> 实验目的</h2><p>学习访问控制列表 ACL 的配置方法，学习防火墙的基本使用方法。</p><h2 id="实验原理" tabindex="-1"><a class="header-anchor" href="#实验原理" aria-hidden="true">#</a> 实验原理</h2><h3 id="ip-包过滤技术" tabindex="-1"><a class="header-anchor" href="#ip-包过滤技术" aria-hidden="true">#</a> IP 包过滤技术</h3><p>对路由器需要转发的数据包，先获取包头信息，然后和设定的规则进行比较，根据比较的结果对数据包进行转发或者丢弃。而实现包过滤的核心技术是访问控制列表。</p><p><img src="'+t+'" alt="image-20230404211701800" loading="lazy"></p><h3 id="访问控制列表" tabindex="-1"><a class="header-anchor" href="#访问控制列表" aria-hidden="true">#</a> 访问控制列表</h3><p>访问控制列表的作用：</p><ul><li>访问控制列表可以用于防火墙；</li><li>访问控制列表可以用于 QoS（Quality of Service），对数据流量进行控制；</li><li>在 DCC 中，访问控制列表还可用来规定触发拨号的条件；</li><li>访问控制列表还可以用于地址转换；</li><li>在配置路由策略时，可以利用访问控制列表来作路由信息的过滤。</li></ul><p>访问控制列表的定义：</p><p>一个 IP 数据包如下图所示（图中 IP 所承载的上层协议为 TCP/UDP）：</p><p><img src="'+i+`" alt="image-20230404212038243" loading="lazy"></p><div class="custom-container tip"><p>对于 TCP/UDP 来说，这 5 个元素组成了一个 TCP/UDP 相关，访问控制列表就是利用这些元素定义的规则</p></div><p>访问控制列表的分类：</p><p>按照访问控制列表的用途可以分为四类:</p><ul><li>基本的访问控制列表（basic acl）</li><li>高级的访问控制列表（advanced acl）</li><li>基于接口的访问控制列表（interface-based acl）</li><li>基于 MAC 的访问控制列表（mac-based acl）</li></ul><p>访问控制列表的标识：</p><ul><li>利用数字标识访问控制列表</li><li>利用数字范围标识访问控制列表的种类</li></ul><table><thead><tr><th>列表的种类</th><th>数字标识的范围</th></tr></thead><tbody><tr><td>基于接口的访问控制列表</td><td>1000 ～ 1999</td></tr><tr><td>基本的访问控制列表</td><td>2000 ～ 2999</td></tr><tr><td>高级的访问控制列表</td><td>3000 ～ 3999</td></tr><tr><td>基于 MAC 地址访问控制列表</td><td>4000 ～ 4999</td></tr></tbody></table><h3 id="基本访问控制列表" tabindex="-1"><a class="header-anchor" href="#基本访问控制列表" aria-hidden="true">#</a> 基本访问控制列表</h3><p>基本访问控制列表只使用源地址描述数据，表明是允许还是拒绝。</p><p>配置基本访问列表的命令格式如下：</p><ul><li><code>acl number &lt;acl-number&gt; (match-order {config|auto})</code></li><li><code>rule (rule-id) {permit|deny} [source sour-addr sour-wildcard|any] [time-range time-name] [logging] [fragment] [vpn-instance vpn-instanc-name]</code></li></ul><p>反掩码和子网掩码相似，但写法不同：</p><ul><li>0 表示需要比较</li><li>1 表示忽略比较</li></ul><p>反掩码和 IP 地址结合使用，可以描述一个地址范围：</p><table><thead><tr><th>First quarter</th><th>Second quarter</th><th>Third quarter</th><th>Last quarter</th><th>Comment</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>255</td><td>只比较前 24 位</td></tr><tr><td>0</td><td>0</td><td>3</td><td>255</td><td>只比较前 22 位</td></tr><tr><td>0</td><td>255</td><td>255</td><td>255</td><td>只比较前 8 位</td></tr></tbody></table><p>反掩码的实质：<strong>根据掩码，按位取反</strong></p><p>如：</p><ul><li>匹配 192.168.0.0 /16 网段，反掩码应该为 0.0.255.255</li><li>匹配 192.168.1.0 /26 网段，反掩码应该为 0.0.0.(255-192)=0.0.0.63</li><li>0.0.0.0 0.0.0.0 匹配所有地址，等同于 any</li><li>192.168.1.5 0.0.0.0 匹配单独的 ip 地址</li><li>192.168.1.5 255.255.255.255 根据反掩码，都不匹配，也等同于 any</li></ul><p>实例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>acl number <span class="token number">2000</span>
rule <span class="token number">1</span> deny <span class="token builtin class-name">source</span> <span class="token number">192.110</span>.10.0 <span class="token number">0.0</span>.0.255
rule <span class="token number">2</span> permit <span class="token builtin class-name">source</span> <span class="token number">202.110</span>.10.0 <span class="token number">0.0</span>.0.255
rule <span class="token number">3</span> permit <span class="token builtin class-name">source</span> any
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+l+`" alt="image-20230406111834389" loading="lazy"></p><h3 id="高级访问控制列表" tabindex="-1"><a class="header-anchor" href="#高级访问控制列表" aria-hidden="true">#</a> 高级访问控制列表</h3><p>高级访问控制列表使用除源地址外更多的信息描述数据包，表明是允许还是拒绝。</p><p>高级访问控制列表规则的配置命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rule <span class="token punctuation">[</span>rule-id<span class="token punctuation">]</span> <span class="token punctuation">{</span>permit<span class="token operator">|</span>deny<span class="token punctuation">}</span> protocol
   <span class="token punctuation">[</span>source sour-addr sour-wildcard<span class="token operator">|</span>any<span class="token punctuation">]</span>
   <span class="token punctuation">[</span>destination dest-addr dest-mask<span class="token operator">|</span>any<span class="token punctuation">]</span>
   <span class="token punctuation">[</span>soucre-port operator port1 <span class="token punctuation">(</span>port2<span class="token punctuation">)</span><span class="token punctuation">]</span>
   <span class="token punctuation">[</span>destination-port operator port1<span class="token punctuation">(</span>port2<span class="token punctuation">)</span><span class="token punctuation">]</span>
   <span class="token punctuation">[</span>icmp-type <span class="token punctuation">{</span>icmp-message<span class="token operator">|</span>icmp-type icmp-code<span class="token punctuation">}</span><span class="token punctuation">]</span>
   <span class="token punctuation">[</span>precedence precedence<span class="token punctuation">]</span> <span class="token punctuation">[</span>tos tos<span class="token punctuation">]</span> <span class="token punctuation">[</span>time-range time-name<span class="token punctuation">]</span>
   <span class="token punctuation">[</span>logging<span class="token punctuation">]</span> <span class="token punctuation">[</span>fragment<span class="token punctuation">]</span> <span class="token punctuation">[</span>vpn-instance vpn-instanc-name<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中：</p><table><thead><tr><th>操作符及语法</th><th>意义</th></tr></thead><tbody><tr><td>eq portnumber</td><td>等于端口号 portnumber</td></tr><tr><td>gt portnumber</td><td>大于端口号 portnumber</td></tr><tr><td>lt portnumber</td><td>小于端口号 portnumber</td></tr><tr><td>neq portnumber</td><td>不等于端口号 portnumber</td></tr><tr><td>range portnumber1 portnumber2</td><td>介于端口号 portnumber1 和 portnumber2 之间</td></tr></tbody></table><p>如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>acl number <span class="token number">3000</span>
rule <span class="token number">1</span> permit tcp <span class="token builtin class-name">source</span> <span class="token number">202.110</span>.10.0 <span class="token number">0.0</span>.0.255 destination <span class="token number">179.100</span>.17.10 <span class="token number">0.0</span>.0.0 destination-port eq www
rule <span class="token number">2</span> deny <span class="token function">ip</span> <span class="token builtin class-name">source</span> any destionation any
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+p+`" alt="image-20230406111251960" loading="lazy"></p><p>或是：</p><ul><li><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rule deny icmp <span class="token builtin class-name">source</span> <span class="token number">10.1</span>.0.0 <span class="token number">0.0</span>.255.255 destination any icmp-type host-redirect
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+r+`" alt="image-20230406112024277" loading="lazy"></p></li><li><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rule deny tcp <span class="token builtin class-name">source</span> <span class="token number">129.9</span>.0.0 <span class="token number">0.0</span>.255.255 destination <span class="token number">202.38</span>.160.0 <span class="token number">0.0</span>.0.255 destination-port eq www
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+d+`" alt="image-20230406112048633" loading="lazy"></p></li></ul><h3 id="访问控制列表的显示" tabindex="-1"><a class="header-anchor" href="#访问控制列表的显示" aria-hidden="true">#</a> 访问控制列表的显示</h3><p>访问控制列表的显示与调试：</p><ul><li>display acl {all|acl-number}</li><li>reset acl counter {all|acl-number}</li></ul><h3 id="访问控制列表的匹配规则" tabindex="-1"><a class="header-anchor" href="#访问控制列表的匹配规则" aria-hidden="true">#</a> 访问控制列表的匹配规则</h3><p>一条访问列表可以由多条规则组成，对于这些规则，有两种匹配顺序：auto 和 config。规则冲突时，若匹配顺序为 auto（深度优先），描述的地址范围越小的规则，将会优先考虑。</p><blockquote><p>深度的判断要依靠通配比较位和 IP 地址结合比较：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>rule deny <span class="token number">202.38</span>.0.0  <span class="token number">0.0</span>.255.255
rule permit <span class="token number">202.38</span>.160.0  <span class="token number">0.0</span>.0.255
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>两条规则结合则表示禁止一个大网段 （202.38.0.0）上的主机但允许其中的一小部分主 机（202.38.160.0）的访问。</p></blockquote><p>规则冲突时，若匹配顺序为 config，先配置的规则会被优先考虑。</p><div class="custom-container tip"><p>“深度优先” 原则的具体标准如下：</p><ul><li>对于基本访问控制列表的规则，直接比较源地址通配符，通配符相同的按配置顺序；</li><li>对基于接口过滤的访问控制规则，配置了 any 的规则排在后面，其他的按配置顺序；</li><li>对于高级访问控制规则，首先比较源地址通配符，相同的再比较目的地址通配符，仍相同比较端口号范围，范围小的排在前面，如果都相同就按配置顺序。</li></ul></div><h3 id="访问控制列表的使用" tabindex="-1"><a class="header-anchor" href="#访问控制列表的使用" aria-hidden="true">#</a> 访问控制列表的使用</h3><p>防火墙配置常见步骤：</p><ul><li>启用防火墙</li><li>定义访问控制列表</li><li>将访问控制列表应用到接口上</li></ul><p>对应命令：</p><ul><li><p>打开或者关闭防火墙：<code>firewall {enable|disable}</code></p></li><li><p>设置防火墙的缺省过滤模式：<code>firewall default {permit|deny}</code></p></li><li><p>显示防火墙的统计信息：</p><p><code>display firewall-statistics {all|interface interface-name|fragments-inspect}</code></p></li><li><p>打开防火墙包过滤调试信息开关：</p><p><code>debugging firewall {all|icmp|tcp|udp|others} [interface interface-name]</code></p></li></ul><p>在接口上应用访问控制列表：</p><ul><li><p>将访问控制列表应用到接口上</p></li><li><p>指明在接口上是 OUT 还是 IN 方向</p></li><li><p>在接口视图下配置：</p><p><code>firewall packet-filter acl-number {inbound|outbound} [match-fragments {normally|exactly}]</code></p></li></ul><p><img src="`+c+`" alt="image-20230406113249538" loading="lazy"></p><p>如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>acl num <span class="token number">3000</span>
rule deny icmp <span class="token builtin class-name">source</span> <span class="token number">202.110</span>.10.1 <span class="token number">0.0</span>.0.255 destination <span class="token number">179.100</span>.17.10 <span class="token number">0.0</span>.0.0 icmp-type echo-reply
firewall <span class="token builtin class-name">enable</span>
interface e <span class="token number">0</span>
firewall packet-filter <span class="token number">3000</span> inbound
interface s <span class="token number">0</span>
firewall packet-filter <span class="token number">3000</span> outbound
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实验步骤" tabindex="-1"><a class="header-anchor" href="#实验步骤" aria-hidden="true">#</a> 实验步骤</h2><p>按图示搭建网络环境：</p><p><img src="`+o+`" alt="image-20230406113344329" loading="lazy"></p><p>在 R1 上设置：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>acl num <span class="token number">3000</span>
rule deny <span class="token function">ip</span> <span class="token builtin class-name">source</span> <span class="token number">202.0</span>.0.0 <span class="token number">0.0</span>.0.255 destination <span class="token number">202.0</span>.1.0 <span class="token number">0.0</span>.0.255
firewall <span class="token builtin class-name">enable</span>
interface e <span class="token number">0</span>
firewall packet-filter <span class="token number">3000</span> inbound
interface s <span class="token number">0</span>
firewall packet-filter <span class="token number">3000</span> outbound
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,68),b=[m];function h(v,k){return a(),s("div",null,b)}const f=n(u,[["render",h],["__file","06-访问控制列表及防火墙使用.html.vue"]]);export{f as default};
